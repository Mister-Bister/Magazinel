<html lang="ro">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Website cu taburi â€” Produse & CoÈ™</title>
<style>
  :root{--bg:#f5f5f5;--dark:#333;--accent:#007bff;--green:#28a745}
  body{font-family:Inter, Arial, sans-serif; margin:0; background:var(--bg); color:#111}
  .tabs{display:flex;background:var(--dark);color:#fff}
  .tab{flex:1;padding:14px 10px;text-align:center;cursor:pointer}
  .tab.active{background:#444}
  .tab-content{display:none;padding:16px}
  .tab-content.active{display:block}
  .products{display:flex;flex-wrap:wrap;gap:14px}
  .product-card{width:160px;background:#fff;border-radius:10px;box-shadow:0 6px 14px rgba(0,0,0,.06);overflow:hidden;text-align:center;padding:10px;position:relative}
  .product-card img{width:100%;height:110px;object-fit:cover;border-radius:6px}
  .product-card .name{margin-top:8px;font-weight:600;font-size:14px;min-height:36px}
  .product-card .price{font-size:13px;color:#555;margin-top:4px}
  .product-card .stock{font-size:12px;color:#666;margin-top:2px}
  .product-card .actions{margin-top:10px}
  .btn{border:0;padding:8px 10px;border-radius:8px;cursor:pointer}
  .add-btn{background:var(--green);color:#fff}
  .delete-btn{background:red;color:#fff;position:absolute;top:5px;right:5px;font-size:12px;padding:4px 6px;border-radius:6px}
  #add-product-btn{position:fixed;right:20px;bottom:20px;width:56px;height:56px;border-radius:50%;font-size:28px;background:var(--accent);color:#fff;border:0;cursor:pointer;box-shadow:0 8px 18px rgba(0,0,0,.15); display:none;}
  /* cart */
  .cart-item{display:flex;gap:10px;align-items:center;background:#fff;padding:10px;border-radius:8px;margin-bottom:10px;box-shadow:0 4px 10px rgba(0,0,0,.05)}
  .cart-item img{width:64px;height:64px;object-fit:cover;border-radius:6px}
  .cart-item .nm{flex:1;font-weight:600}
  .cart-item .price{margin-left:8px;font-size:13px;color:#333}
  .cart-bottom{display:flex;gap:8px;margin-top:14px;align-items:center;flex-wrap:wrap}
  .cart-total{font-weight:700;margin-top:8px}
  input[type=text]{flex:1;padding:8px;border-radius:8px;border:1px solid #ddd}
  button.send-btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
  /* messages list */
  .message-card{background:#fff;padding:12px;border-radius:8px;margin-bottom:10px;box-shadow:0 4px 10px rgba(0,0,0,.04);position:relative}
  .msg-meta{font-size:12px;color:#666;margin-bottom:8px}
  .msg-items{display:flex;flex-wrap:wrap;gap:8px}
  .msg-item{display:flex;align-items:center;gap:8px;background:#fafafa;padding:6px;border-radius:6px}
  .msg-item img{width:36px;height:36px;object-fit:cover;border-radius:4px}
  .finished-badge{position:absolute;top:8px;right:8px;background:green;color:#fff;font-size:12px;padding:2px 6px;border-radius:6px}
  @media (max-width:520px){
    .products{justify-content:center}
    .product-card{width:44%}
  }
  .login-btn{background:#fff;color:#000;font-size:12px;padding:4px 6px;margin:6px;border-radius:6px;cursor:pointer;position:absolute;right:10px;top:10px}
</style>
</head>
<body>

<!-- Tabs -->
<div class="tabs" id="tabsBar">
  <div class="tab active" data-tab="produse">Produse</div>
  <div class="tab" data-tab="cos">CoÈ™</div>
  <div class="tab" data-tab="mesaje" style="display:none;">Mesaje</div>
  <button class="login-btn" id="loginBtn">Login</button>
</div>

<!-- PRODUSE -->
<div id="produse" class="tab-content active">
  <div style="margin-bottom:10px;color:#333">
    Lista de produse â€” apasÄƒ + pentru a adÄƒuga unul nou (nume + link imagine + preÈ› + stoc)
  </div>
  <div class="products" id="products-container">
    <div style="color:#666">Nu existÄƒ produse Ã®ncÄƒ. ApasÄƒ + pentru a adÄƒuga unul.</div>
  </div>
</div>

<!-- COS -->
<div id="cos" class="tab-content">
  <div id="cart-container">
    <div style="color:#666">CoÈ™ul este gol.</div>
  </div>
  <div class="cart-bottom">
    <input id="user-name" type="text" placeholder="Numele tÄƒu">
    <button class="send-btn" id="submit-order">Trimite comanda</button>
  </div>
  <div class="cart-total" id="cart-total"></div>
</div>

<!-- MESAGE -->
<div id="mesaje" class="tab-content">
  <div style="margin-bottom:10px;color:#333">Toate comenzile primite (live)</div>
  <div id="messages-list">
    <div style="color:#666">Nu existÄƒ comenzi Ã®ncÄƒ.</div>
  </div>
</div>

<!-- Floating add product button -->
<button id="add-product-btn" title="AdaugÄƒ produs">+</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, updateDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCY059AnI44qLOqdkvYy02Yk3L2QPNtzNk",
  authDomain: "magazun-fa436.firebaseapp.com",
  projectId: "magazun-fa436",
  storageBucket: "magazun-fa436.appspot.com",
  messagingSenderId: "474271636665",
  appId: "1:474271636665:web:b5018c0ec964f029014f68"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let products = [];
let cart = [];
let isAdmin = false;
const adminUser = "Vasilealexjonny";
const adminPass = "02050103";

/* UI refs */
const productsContainer = document.getElementById('products-container');
const cartContainer = document.getElementById('cart-container');
const cartTotalEl = document.getElementById('cart-total');
const addProductBtn = document.getElementById('add-product-btn');
const submitOrderBtn = document.getElementById('submit-order');
const userNameInput = document.getElementById('user-name');
const tabsBar = document.getElementById('tabsBar');
const loginBtn = document.getElementById('loginBtn');

/* Tabs */
tabsBar.addEventListener('click', (ev) => {
  const tabEl = ev.target.closest('.tab');
  if(!tabEl) return;
  const target = tabEl.dataset.tab;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  tabEl.classList.add('active');
  const content = document.getElementById(target);
  if(content) content.classList.add('active');
});

/* Login */
loginBtn.addEventListener('click', () => {
  const user = prompt("Username:");
  const pass = prompt("Password:");
  if(user === adminUser && pass === adminPass){
    isAdmin = true;
    addProductBtn.style.display = "block";
    document.querySelector('.tab[data-tab="mesaje"]').style.display = "block";
    alert("Bine ai venit, admin!");
  } else alert("Username sau parola gresita.");
});

/* Products */
const productsCol = collection(db,"products");
const productsQuery = query(productsCol, orderBy("createdAt","desc"));
onSnapshot(productsQuery, snap => {
  products=[];
  snap.forEach(docSnap=>{
    const d = docSnap.data();
    products.push({id:docSnap.id,name:d.name,img:d.img,price:d.price,stock:d.stock});
  });
  renderProducts();
});

function renderProducts(){
  productsContainer.innerHTML='';
  if(products.length===0){
    productsContainer.innerHTML='<div style="color:#666">Nu existÄƒ produse Ã®ncÄƒ.</div>';
    return;
  }
  products.forEach((p,idx)=>{
    const card=document.createElement('div');
    card.className='product-card';
    const stockText = p.stock > 0 ? `Stoc: ${p.stock}` : 'Stoc epuizat';
    card.innerHTML=`
      <img src="${p.img}" alt="${p.name}" />
      <div class="name">${p.name}</div>
      <div class="price">PreÈ›: ${parseFloat(p.price).toFixed(2)} RON</div>
      <div class="stock">${stockText}</div>
      <div class="actions">
        <button class="btn add-btn" data-index="${idx}" ${p.stock <= 0 ? 'disabled' : ''}>AdaugÄƒ la coÈ™</button>
      </div>
    `;
    if(isAdmin){
      const delBtn=document.createElement('button');
      delBtn.className='delete-btn';
      delBtn.textContent='âœ•';
      delBtn.onclick=async()=>{ await deleteDoc(doc(db,"products",p.id)); };
      card.appendChild(delBtn);
    }
    productsContainer.appendChild(card);
  });

  productsContainer.querySelectorAll('.add-btn').forEach(btn=>{
    btn.addEventListener('click', async()=>{
      const index = Number(btn.dataset.index);
      const product = products[index];
      if(product.stock <= 0) return alert("Stoc epuizat!");
      addToCart(index);
      const productRef = doc(db,"products",product.id);
      await updateDoc(productRef,{stock: product.stock - 1});
    });
  });
}

/* Add product */
addProductBtn.addEventListener('click', async()=>{
  const name = prompt("Numele produsului:");
  if(!name) return;
  const img = prompt("Link imagine (ex: https://i.imgur.com/xxxx.jpg):");
  if(!img) return alert("Trebuie un link direct de la Imgur!");
  const price = prompt("PreÈ› (RON):");
  if(!price || isNaN(price)) return alert("PreÈ› invalid!");
  const stock = prompt("NumÄƒr de produse Ã®n stoc:");
  if(!stock || isNaN(stock) || Number(stock) < 0) return alert("Stoc invalid!");
  await addDoc(productsCol,{name,img,price:parseFloat(price).toFixed(2),stock:Number(stock),createdAt:serverTimestamp()});
});

/* Cart */
function addToCart(index){cart.push(products[index]); renderCart();}
function renderCart(){
  cartContainer.innerHTML='';
  if(cart.length===0){cartContainer.innerHTML='<div style="color:#666">CoÈ™ul este gol.</div>'; cartTotalEl.textContent=''; return;}
  let total=0;
  cart.forEach((item,idx)=>{
    total+=parseFloat(item.price);
    const el=document.createElement('div');
    el.className='cart-item';
    el.innerHTML=`
      <img src="${item.img}" alt="${item.name}"/>
      <div class="nm">${item.name}</div>
      <div class="price">${parseFloat(item.price).toFixed(2)} RON</div>
      <button class="btn" data-idx="${idx}" title="È˜terge">âœ•</button>
    `;
    cartContainer.appendChild(el);
  });
  cartTotalEl.textContent=`Total: ${total.toFixed(2)} RON`;
  cartContainer.querySelectorAll('button[data-idx]').forEach(b=>{
    b.addEventListener('click',()=>{cart.splice(Number(b.dataset.idx),1); renderCart();});
  });
}

/* Submit order */
submitOrderBtn.addEventListener('click', async()=>{
  const name=userNameInput.value.trim();
  if(!name){alert("IntroduceÈ›i numele"); return;}
  if(cart.length===0){alert("CoÈ™ul este gol"); return;}
  await addDoc(collection(db,"orders"),{
    name,
    items:cart.map(i=>({name:i.name,img:i.img,price:i.price})),
    createdAt:serverTimestamp(),
    finished:false
  });
  cart=[]; renderCart();
  userNameInput.value='';
});

/* Orders / Mesaje tab */
const ordersCol = collection(db,"orders");
const ordersQuery = query(ordersCol, orderBy("createdAt","desc"));
onSnapshot(ordersQuery,snap=>{
  if(!isAdmin) return;
  const container=document.getElementById('messages-list');
  container.innerHTML='';
  if(snap.empty){ container.innerHTML='<div style="color:#666">Nu existÄƒ comenzi Ã®ncÄƒ.</div>'; return; }
  snap.forEach(docSnap=>{
    const d=docSnap.data();
    const card=document.createElement('div');
    card.className='message-card';
    if(d.finished){card.style.opacity='0.6';}
    let total=0;
    let itemsHtml='';
    if(d.items && d.items.length){
      d.items.forEach(it=>{total+=parseFloat(it.price); itemsHtml+=`<div class="msg-item"><img src="${it.img}"/><span>${it.name} - ${it.price} RON</span></div>`;});
    }
    const receiptText=
`ComandÄƒ de la ${d.name}
------------------------
${d.items.map(it=>`â€¢ ${it.name} â€” ${it.price} RON`).join('\n')}
------------------------
Total: ${total.toFixed(2)} RON`;

    const copyBtn=document.createElement('button');
    copyBtn.textContent=d.finished?"âœ… Copiat":"ðŸ“‹ CopiazÄƒ comanda";
    copyBtn.className="btn";
    copyBtn.style.marginTop="8px";
    copyBtn.disabled=!!d.finished;
    copyBtn.onclick=async()=>{
      try{
        await navigator.clipboard.writeText(receiptText);
        copyBtn.textContent="âœ… Copiat!";
        copyBtn.disabled=true;
        card.style.opacity="0.6";
        const orderRef=doc(db,"orders",docSnap.id);
        await updateDoc(orderRef,{finished:true});
      }catch(e){ alert("Nu s-a putut copia automat. CopiazÄƒ manual:\n\n"+receiptText);}
    };

    if(d.finished){
      const badge=document.createElement('div'); badge.className='finished-badge'; badge.textContent='âœ” Finished';
      card.appendChild(badge);
    }

    card.innerHTML+=`<div class="msg-meta"><b>${d.name}</b></div><div class="msg-items">${itemsHtml}</div><div class="cart-total">Total: ${total.toFixed(2)} RON</div>`;
    card.appendChild(copyBtn);
    container.appendChild(card);
  });
});

</script>
</body>
</html>


